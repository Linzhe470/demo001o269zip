<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
    <link href="./css/style.css" rel="stylesheet" />
    <script>
      // 提供記錄是否已下載完 poi 資料，於 gps 更新時不再載一次
      let poi_download = false;

      let testEntityAdded = false;
      window.onload = () => {
        const el = document.querySelector("[gps-new-camera]");
        const resetBtn = document.querySelector(".reload-poi-button");
        console.log(el);
        console.log(resetBtn);

        el.addEventListener("gps-camera-update-position", (e) => {
          console.log(1122);
          alert(1122);
          // if(!testEntityAdded) {
          //     alert(`Got first GPS position: lon ${e.detail.position.longitude} lat ${e.detail.position.latitude}`);
          //     // Add a box to the north of the initial GPS position
          //     const entity = document.createElement("a-box");
          //     entity.setAttribute("scale", {
          //         x: 20,
          //         y: 20,
          //         z: 20
          //     });
          //     entity.setAttribute('material', { color: 'red' } );
          //     entity.setAttribute('gps-new-entity-place', {
          //         latitude: e.detail.position.latitude + 0.001,
          //         longitude: e.detail.position.longitude
          //     });
          //     document.querySelector("a-scene").appendChild(entity);
          // }
          testEntityAdded = true;
        });

        // navigator.geolocation.getCurrentPosition((position) => {
        //   console.log(position.coords.latitude);
        //   console.log(position.coords.longitude);
        //   console.log(document.querySelector("#wwww"));
        //   document
        //     .querySelector("a-text")
        //     .setAttribute(
        //       "gps-entity-place",
        //       `latitude: ${position.coords.latitude}; longitude: ${position.coords.longitude};`
        //     );
        // });

        // 註冊 更新資料 鈕的處理事件
        document;
        resetBtn.addEventListener("click", function () {
          window.location.reload();
        });
      };
    </script>
  </head>

  <body style="margin: 0; overflow: hidden">
    <!-- 外加dom結構 -->
    <!-- <div class="arjs-loader">
      <div>GPS 訊號及資料讀取中</div>
    </div> -->
    <div class="header">
      AR：展示mp4影片

      <button class="reload-poi-button">重整</button>
    </div>
    <!-- <div class="footer">
      <span id="gps-info">GPS...</span>
    </div> -->

    <a-scene
      vr-mode-ui="enabled: false;"
      loading-screen="enabled: false;"
      renderer="logarithmicDepthBuffer: true;"
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
      id="scene"
      embedded
      gesture-detector
    >
      <a-assets>
        <a-asset-item
          id="animated-asset"
          src="assets/asset.gltf"
        ></a-asset-item>
      </a-assets>

      <a-marker
        id="animated-marker"
        type="pattern"
        preset="custom"
        url="assets/marker.patt"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;"
        id="markerA"
      >
        <a-entity
          id="bowser-model"
          scale="0.8 0.8 0.8"
          rotation="-90 0 0"
          position="0 0 0"
          animation-mixer="loop: repeat"
          gltf-model="#animated-asset"
          class="clickable"
          gesture-handler
        ></a-entity>
      </a-marker>
      <!-- <a-text id="wwww"
       value="WWWWWWWWWWWWWWWWWWWWWWWWWWWWWABC"
        look-at="[gps-camera]"
        scale="75 75 75" color="#FF0000"
      ></a-text>
      <a-text
        id="welcome"
        value="LIVE"
        scale="20 20 20"
        color="#FF0000"
        position="-30 0 -150"
      ></a-text> -->
      <!-- <a-entity camera></a-entity> -->
      <a-camera
        id="acamera"
        gps-new-camera="gpsMinDistance: 5; positionMinAccuracy: 30; alert: false;"
        camera=""
        position=""
        rotation=""
        look-controls=""
        wasd-controls=""
        look-controls-enabled="true"
      ></a-camera>

      <!-- <a-camera gps-camera rotation-reader> </a-camera> -->
    </a-scene>
  </body>
</html>
